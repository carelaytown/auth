<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>管理人室 - CARELAYタウン</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #f9f9f9;
      padding: 30px;
    }
    h1 {
      color: #2a6ebb;
      margin-bottom: 20px;
    }
    .tab-buttons {
      margin-bottom: 20px;
    }
    .tab-buttons button {
      padding: 10px 20px;
      margin-right: 10px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #ccc;
      color: #333;
    }
    .tab-buttons button.active {
      background-color: #2a6ebb;
      color: #fff;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>管理人室</h1>
  <div class="tab-buttons">
    <button id="tab-account" class="active">👥アカウント承認・解除</button>
    <button id="tab-category">📂カテゴリ表示設定</button>
    <button id="tab-apps">📱アプリ管理</button>
  </div>
  <div id="tab-account-panel" class="tab-content active"></div>
  <div id="tab-category-panel" class="tab-content"></div>
  <div id="tab-apps-panel" class="tab-content"></div>

  <script>
    const supabase = supabase.createClient(
      "https://viihcgkjzzhkdiwdzdex.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzIiwicmVmIjoidmlpaGNna2p6emhrZGl3ZHpkZXgiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTc0NjA3MTgwOSwiZXhwIjoyMDYxNjQ3ODA5fQ.3SMdVvDEp103fwnLvgtsec7J7ly4A_SEJlrEb0BZ9YM"
    );

    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.tab-buttons button');
      const panels = document.querySelectorAll('.tab-content');

      tabs.forEach(btn => {
        btn.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('active'));
          panels.forEach(p => p.classList.remove('active'));

          btn.classList.add('active');
          const targetId = btn.id.replace('tab-', '') + '-panel';
          document.getElementById(targetId).classList.add('active');
        });
      });

      loadFragments();
    });

    async function loadFragments() {
      const fragments = [
        { id: 'tab-account-panel', file: 'admin-account.html', init: 'initAdminAccountPanel' },
        { id: 'tab-category-panel', file: 'admin-category.html', init: 'initAdminCategoryPanel' },
        { id: 'tab-apps-panel', file: 'admin-apps.html', init: 'initAdminAppsPanel' },
      ];

      for (const { id, file, init } of fragments) {
        try {
          const res = await fetch(file);
          const html = await res.text();
          document.getElementById(id).innerHTML = html;
          if (typeof window[init] === 'function') window[init]();
        } catch (e) {
          document.getElementById(id).innerHTML = `<p style='color:red'>${file} の読み込みに失敗しました</p>`;
        }
      }
    }
  </script>
</body>
</html>
