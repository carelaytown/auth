<!-- admin-account.html（修正版） -->
<div class="content" style="margin: 30px 40px 30px 260px;">
  <h2>アカウント管理</h2>
  <div style="margin-bottom: 10px;">
    <button onclick="updateStatus('approved')">承認</button>
    <button onclick="updateStatus('pending')">解除</button>
    <button onclick="deleteSelected()">削除</button>
  </div>
  <div style="margin-bottom: 15px;">
    <label><input type="radio" name="filter" value="all" checked onchange="filterRows(this)"> すべて</label>
    <label><input type="radio" name="filter" value="pending" onchange="filterRows(this)"> 未承認のみ</label>
    <label><input type="radio" name="filter" value="approved" onchange="filterRows(this)"> 承認済みのみ</label>
  </div>
  <table id="accountTable">
    <thead>
      <tr>
        <th><input type="checkbox" onclick="toggleAll(this)"></th>
        <th>事業所名</th>
        <th>メールアドレス</th>
        <th>状態</th>
        <th>管理者</th>
      </tr>
    </thead>
    <tbody id="accountTableBody"></tbody>
  </table>
</div>

<script>
async function updateStatus(newStatus) {
  const selected = Array.from(document.querySelectorAll('#accountTableBody input[type="checkbox"]:checked'));
  const ids = selected.map(cb => cb.dataset.id);
  if (ids.length === 0) return alert('1件以上選択してください');

  const { data, error } = await supabase
    .from('applications')
    .update({ status: newStatus })
    .in('id', ids);
  if (error) return alert('更新失敗: ' + error.message);
  location.reload();
}

async function deleteSelected() {
  const selected = Array.from(document.querySelectorAll('#accountTableBody input[type="checkbox"]:checked'));
  const ids = selected.map(cb => cb.dataset.id);
  if (ids.length === 0) return alert('1件以上選択してください');

  const { error } = await supabase.from('applications').delete().in('id', ids);
  if (error) return alert('削除失敗: ' + error.message);
  location.reload();
}

function toggleAll(master) {
  document.querySelectorAll('#accountTableBody input[type="checkbox"]').forEach(cb => {
    cb.checked = master.checked;
  });
}

function filterRows(radio) {
  const rows = document.querySelectorAll('#accountTableBody tr');
  rows.forEach(row => {
    const status = row.dataset.status;
    row.style.display = radio.value === 'all' || status === radio.value ? '' : 'none';
  });
}
</script>
