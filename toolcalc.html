
<div id="toolcalc-app" style="display:flex; gap:20px; justify-content:center; align-items:flex-start;">
  <style>
    #toolcalc-app {
      font-family: Arial, sans-serif;
      max-width: 400px;
      margin: 20px auto;
      padding: 16px;
      background: #f5f5f5;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.2);
    }
    .display-area {
      margin-bottom: 12px;
    }
    .display-area .formula,
    .display-area .result {
      width: 100%;
      padding: 10px;
      margin-bottom: 4px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background: white;
      text-align: right;
    }
    .display-area .formula { font-size: 18px; color: #555; }
    .display-area .result { font-size: 24px; font-weight: bold; }
    .button-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 16px;
    }
    .button-grid button {
      padding: 16px;
      font-size: 18px;
      border: none;
      border-radius: 6px;
      background-color: #eee;
      cursor: pointer;
      transition: transform 0.1s, background 0.1s;
    }
    .button-grid button:active { transform: scale(0.95); }
    .button-grid button.op { background-color: #d1e7fd; }
    .button-grid button.op:active { background-color: #aad4fa; }
    .button-grid button.eq { background-color: #fcd34d; }
    .button-grid button.eq:active { background-color: #fbbf24; }
    .button-grid button.ac { background-color: #fca5a5; }
    .button-grid button.ac:active { background-color: #f87171; }
    .button-grid button.tax { background-color: #c7d2fe; }
    .button-grid button.tax:active { background-color: #a5b4fc; }
  </style>

  <div id="left-panel" style="flex-shrink:0; width:220px;">
<div class="display-area">
    <div class="formula" id="formula">式</div>
    <div class="result" id="result">0</div>
  </div>

  <div class="button-grid">
    <button class="ac" type="button" onclick="clearCalc()">AC</button>
    <button type="button" onclick="appendCalc('(')">(</button>
    <button type="button" onclick="appendCalc(')')">)</button>
    <button class="op" type="button" onclick="appendCalc('/')">÷</button>

    <button type="button" onclick="appendCalc('7')">7</button>
    <button type="button" onclick="appendCalc('8')">8</button>
    <button type="button" onclick="appendCalc('9')">9</button>
    <button class="op" type="button" onclick="appendCalc('*')">×</button>

    <button type="button" onclick="appendCalc('4')">4</button>
    <button type="button" onclick="appendCalc('5')">5</button>
    <button type="button" onclick="appendCalc('6')">6</button>
    <button class="op" type="button" onclick="appendCalc('-')">−</button>

    <button type="button" onclick="appendCalc('1')">1</button>
    <button type="button" onclick="appendCalc('2')">2</button>
    <button type="button" onclick="appendCalc('3')">3</button>
    <button class="op" type="button" onclick="appendCalc('+')">＋</button>

    <button type="button" onclick="appendCalc('0')">0</button>
    <button type="button" onclick="appendCalc('.')">.</button>
    <button class="eq" type="button" onclick="computeCalc()">=</button>
    <button class="eq" type="button" onclick="saveHistory()">保存</button>

    <button class="tax" type="button" onclick="applyTax(1.10)">税10%</button>
    <button class="tax" type="button" onclick="applyTax(1.08)">税8%</button>
    <button class="tax" type="button" onclick="removeTax()">非課税</button>
  </div>

  </div>
<div id="right-panel" style="flex-grow:1;">
<script>
    (() => {
      let calcFormula = "";
      let calcResult = "";
      const formulaEl = document.getElementById("formula");
      const resultEl = document.getElementById("result");

      function updateDisplay() {
        formulaEl.textContent = calcFormula || "式";
        resultEl.textContent = calcResult || "0";
      }

      window.appendCalc = function(val) {
        calcFormula += val;
        updateDisplay();
      };

      window.clearCalc = function() {
        calcFormula = "";
        calcResult = "";
        updateDisplay();
      };

      window.computeCalc = function() {
        try {
          calcResult = eval(calcFormula);
        } catch (e) {
          calcResult = "Error";
        }
        updateDisplay();
      };

      window.applyTax = function(rate) {
        if (calcResult !== "" && !isNaN(calcResult)) {
          calcResult = Math.round(calcResult * rate * 100) / 100;
          updateDisplay();
        } else {
          calcFormula += "*" + rate;
          updateDisplay();
        }
      };

      window.removeTax = function() {
        calcFormula = calcFormula.replace(/\*1\.(10|08)/, "");
        computeCalc();
      };

      window.saveHistory = function() {
        alert("保存しました（仮動作）");
      };

      document.addEventListener("keydown", function(e) {
        const key = e.key;
        if ("0123456789.+-*/()".includes(key)) {
          appendCalc(key);
        } else if (key === "Enter") {
          computeCalc();
        } else if (key === "Backspace") {
          calcFormula = calcFormula.slice(0, -1);
          updateDisplay();
        }
      });

      updateDisplay();
    })();
  </script>
</div>
