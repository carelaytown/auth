<style>
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 14px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f0f0f0;
  }
  .btn {
    padding: 4px 8px;
    font-size: 13px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
  }
  .btn-on {
    background-color: #1b355d;
    color: white;
  }
  .btn-off {
    background-color: #aaa;
    color: white;
  }
</style>

<div>
  <h2>ğŸ›  ã‚¢ãƒ—ãƒªç®¡ç†</h2>
  <table>
    <thead>
      <tr>
        <th>ãƒ©ãƒ™ãƒ«</th>
        <th>ãƒšãƒ¼ã‚¸ID</th>
        <th>ã‚«ãƒ†ã‚´ãƒª</th>
        <th>ã‚¢ã‚¤ã‚³ãƒ³</th>
        <th>å…¬é–‹çŠ¶æ…‹</th>
        <th>æ“ä½œ</th>
      </tr>
    </thead>
    <tbody id="appTable">
      <tr><td colspan="6">èª­ã¿è¾¼ã¿ä¸­...</td></tr>
    </tbody>
  </table>
</div>

<script>
  const SUPABASE_URL = 'https://viihcgkjzzhkdiwdzdex.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpaWhjZ2tqenpoa2Rpd2R6ZGV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwNzE4MDksImV4cCI6MjA2MTY0NzgwOX0.3SMdVvDEp103fwnLvgtsec7J7ly4A_SEJlrEb0BZ9YM';
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  async function loadApps() {
    const { data, error } = await supabase
      .from("apps")
      .select("*")
      .order("sort", { ascending: true });

    const tbody = document.getElementById("appTable");
    tbody.innerHTML = "";

    if (error || !data) {
      tbody.innerHTML = `<tr><td colspan="6">èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</td></tr>`;
      return;
    }

    for (const row of data) {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td>${row.label || "-"}</td>
        <td>${row.page || "-"}</td>
        <td>${row.category || "-"}</td>
        <td>${row.icon || "-"}</td>
        <td>${row.is_public ? "å…¬é–‹ä¸­" : "éå…¬é–‹"}</td>
        <td>
          <button class="btn ${row.is_public ? 'btn-off' : 'btn-on'}"
                  onclick="toggleApp('${row.id}', ${row.is_public})">
            ${row.is_public ? 'éå…¬é–‹ã«ã™ã‚‹' : 'å…¬é–‹ã«ã™ã‚‹'}
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    }
  }

  async function toggleApp(id, current) {
    const { error } = await supabase
      .from("apps")
      .update({ is_public: !current })
      .eq("id", id);

    if (error) {
      alert("æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ");
    } else {
      loadApps();
    }
  }

  loadApps();
</script>
