<style>
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
    font-size: 14px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #f0f0f0;
  }
  .btn {
    padding: 4px 8px;
    font-size: 13px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
  }
  .btn-on {
    background-color: #1b355d;
    color: white;
  }
  .btn-off {
    background-color: #aaa;
    color: white;
  }
</style>

<div>
  <h2>📂 メニュー管理</h2>
  <table>
    <thead>
      <tr>
        <th>ラベル</th>
        <th>ページID</th>
        <th>管理者専用</th>
        <th>表示状態</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody id="menuTable">
      <tr><td colspan="5">読み込み中...</td></tr>
    </tbody>
  </table>
</div>

<script>
  const SUPABASE_URL = 'https://viihcgkjzzhkdiwdzdex.supabase.co';
  const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpaWhjZ2tqenpoa2Rpd2R6ZGV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwNzE4MDksImV4cCI6MjA2MTY0NzgwOX0.3SMdVvDEp103fwnLvgtsec7J7ly4A_SEJlrEb0BZ9YM';
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  async function loadMenus() {
    const { data, error } = await supabase
      .from("menu_config")
      .select("*")
      .order("sort", { ascending: true });

    const tbody = document.getElementById("menuTable");
    tbody.innerHTML = "";

    if (error || !data) {
      tbody.innerHTML = `<tr><td colspan="5">読み込みエラー</td></tr>`;
      return;
    }

    for (const row of data) {
      const tr = document.createElement("tr");

      const adminText = row.admin_only ? "✅" : "";
      const showText = row.show ? "表示中" : "非表示";

      tr.innerHTML = `
        <td>${row.label}</td>
        <td>${row.page}</td>
        <td>${adminText}</td>
        <td>${showText}</td>
        <td>
          <button class="btn ${row.show ? 'btn-off' : 'btn-on'}" onclick="toggleMenu('${row.id}', ${row.show})">
            ${row.show ? '非表示にする' : '表示にする'}
          </button>
        </td>
      `;

      tbody.appendChild(tr);
    }
  }

  async function toggleMenu(id, current) {
    const { error } = await supabase
      .from("menu_config")
      .update({ show: !current })
      .eq("id", id);

    if (error) {
      alert("更新に失敗しました");
    } else {
      loadMenus();
    }
  }

  loadMenus();
</script>
