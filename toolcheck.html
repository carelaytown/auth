<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>„ÉÅ„Çß„ÉÉ„ÇØË°®</title>
  <style>
    #toolcheck-app * { box-sizing: border-box; }
    #toolcheck-app {
      font-family: sans-serif;
      padding: 1em;
      max-width: 1200px;
      margin: auto;
    }
    #toolcheck-app .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1em;
    }
    #toolcheck-app .sheet-controls {
      display: flex;
      gap: 8px;
    }
    #toolcheck-app select, #toolcheck-app button {
      padding: 4px 8px;
      font-size: 14px;
    }
    #toolcheck-app .cs-container {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }
    #toolcheck-app .cs-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }
    #toolcheck-app .cs-table th, #toolcheck-app .cs-table td {
      border: 1px solid #ccc;
      padding: 4px;
      font-size: 12px;
      text-align: center;
      word-wrap: break-word;
    }
    #toolcheck-app .cs-table th {
      background-color: #f0f0f0;
    }
    #toolcheck-app .cs-status-Êú™ÂØæÂøú { background-color: #fff3cd; }
    #toolcheck-app .cs-status-ÂØæÂøú‰∏≠ { background-color: #d1ecf1; }
    #toolcheck-app .cs-status-ÂÆå‰∫Ü { background-color: #d4edda; }
    #toolcheck-app .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #toolcheck-app .modal-content {
      background: white;
      padding: 1em;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }
    #toolcheck-app .modal-content label {
      font-weight: bold;
      display: block;
      margin-top: 0.5em;
    }
    #toolcheck-app .modal-content input,
    #toolcheck-app .modal-content textarea,
    #toolcheck-app .modal-content select {
      width: 100%;
      margin-top: 4px;
      padding: 6px;
    }
    #toolcheck-app .modal-buttons {
      margin-top: 1em;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    #toolcheck-app .cs-btn {
      padding: 4px 8px;
      font-size: 12px;
    }
    #toolcheck-app .history-list span {
      display: inline-block;
      background: #eee;
      margin: 2px;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }
    #toolcheck-app .history-list span button {
      margin-left: 4px;
      background: transparent;
      border: none;
      cursor: pointer;
      color: red;
    }
    #toolcheck-app .sheet-combo-wrapper {
      position: relative;
      width: 250px;
    }
    #toolcheck-app .sheet-combo-wrapper input {
      width: 100%;
      padding: 6px 30px 6px 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      appearance: none;
      background-color: white;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 10 6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='%23333'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 8px center;
      background-size: 12px;
    }
  </style>
</head>
<body>
<!-- Á∂ö„Åè -->

<div id="toolcheck-app">
  <div class="header-bar">
    <div class="sheet-combo-wrapper">
      <input id="sheet-combo" list="sheet-options" placeholder="„ÉÅ„Çß„ÉÉ„ÇØË°®Âêç„ÇíÂÖ•Âäõ„ÉªÈÅ∏Êäû">
      <datalist id="sheet-options"></datalist>
    </div>
    <div class="sheet-controls">
      <button id="sheet-new">ÔºãÊñ∞Ë¶è</button>
      <button id="sheet-delete">üóëÂâäÈô§</button>
      <button id="add-entry">‰∫àÂÆö„ÅÆËøΩÂä†</button>
      <button id="export-csv">CSVÂá∫Âäõ</button>
    </div>
  </div>
  <!-- ÁúÅÁï•„Åï„Çå„ÅüÈÉ®ÂàÜ„Å´ÂÆüÈöõ„ÅÆ„ÉÜ„Éº„Éñ„É´„ÇÑ„É¢„Éº„ÉÄ„É´„ÇíÈÖçÁΩÆ -->
  <!-- ‰∏≠Áï• -->
</div>
<script>
(() => {
  const root = document.getElementById("toolcheck-app");
  const combo = document.getElementById("sheet-combo");
  const datalist = document.getElementById("sheet-options");

  let sheets = {};
  let currentSheet = null;

  function saveSheets() {
    localStorage.setItem("toolcheck-sheets", JSON.stringify(sheets));
  }

  function loadSheets() {
    sheets = JSON.parse(localStorage.getItem("toolcheck-sheets") || "{}");
  }

  function renderSheetOptions() {
    datalist.innerHTML = "";
    Object.keys(sheets).forEach(name => {
      const opt = document.createElement("option");
      opt.value = name;
      datalist.appendChild(opt);
    });
    if (!currentSheet && Object.keys(sheets).length > 0) {
      currentSheet = Object.keys(sheets)[0];
    }
    if (currentSheet) combo.value = currentSheet;
  }

  function renderTable() {
    combo.value = sheets[currentSheet]?.title || "Êñ∞„Åó„ÅÑ„ÉÅ„Çß„ÉÉ„ÇØË°®";
    // „Åì„Åì„Åß„ÅØÊú¨‰Ωì„ÉÜ„Éº„Éñ„É´„ÅÆÊèèÁîªÂá¶ÁêÜ„ÅåÂÖ•„Çä„Åæ„ÅôÔºàÁúÅÁï•Ôºâ
  }

  combo.addEventListener("change", () => {
    const name = combo.value;
    if (sheets[name]) {
      currentSheet = name;
      renderTable();
    }
  });

  combo.addEventListener("blur", () => {
    const newName = combo.value.trim();
    if (currentSheet && sheets[currentSheet] && newName && !sheets[newName]) {
      sheets[newName] = sheets[currentSheet];
      delete sheets[currentSheet];
      currentSheet = newName;
      saveSheets();
      renderSheetOptions();
      renderTable();
    }
  });

  root.querySelector("#sheet-new").onclick = () => {
    const name = combo.value.trim();
    if (name && !sheets[name]) {
      sheets[name] = { title: name, data: [] };
      currentSheet = name;
      saveSheets();
      renderSheetOptions();
      renderTable();
    }
  };

  root.querySelector("#sheet-delete").onclick = () => {
    if (!currentSheet) return;
    delete sheets[currentSheet];
    currentSheet = null;
    renderSheetOptions();
    renderTable();
    saveSheets();
  };

  root.querySelector("#export-csv").onclick = () => {
    if (!currentSheet || !sheets[currentSheet]) return;
    const rows = sheets[currentSheet].data || [];
    const csv = ["Êó•‰ªò,ÊãÖÂΩìËÄÖ,È†ÖÁõÆ,ÂÜÖÂÆπ,Á∑†Âàá,Áä∂ÊÖã"];
    rows.forEach(r => {
      csv.push([r.date, r.person, r.type, r.content, r.deadline, r.status].map(f => `"${(f||"").replace(/"/g,'""')}"`).join(","));
    });
    const blob = new Blob([csv.join("\n")], { type: "text/csv" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = (sheets[currentSheet].title || "checksheet") + ".csv";
    a.click();
  };

  loadSheets();
  renderSheetOptions();
  renderTable();
})();
</script>
</body>
</html>
