<div id="toolcheck-app">
  <style>
    #toolcheck-app * {
      box-sizing: border-box;
    }

    #toolcheck-app {
      font-family: sans-serif;
      padding: 1em;
      max-width: 1200px;
      margin: auto;
    }

    #toolcheck-app .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1em;
    }

    #toolcheck-app .sheet-title {
      font-size: 1.5em;
      font-weight: bold;
      flex: 1;
    }

    #toolcheck-app .sheet-title[contenteditable] {
      background: #eef;
      padding: 4px;
      border-radius: 4px;
    }

    #toolcheck-app .sheet-controls {
      display: flex;
      gap: 8px;
    }

    #toolcheck-app select,
    #toolcheck-app button {
      padding: 4px 8px;
      font-size: 14px;
    }

    #toolcheck-app .cs-container {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }

    #toolcheck-app .cs-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    #toolcheck-app .cs-table th,
    #toolcheck-app .cs-table td {
      border: 1px solid #ccc;
      padding: 4px;
      font-size: 12px;
      text-align: center;
      word-wrap: break-word;
    }

    #toolcheck-app .cs-table th {
      background-color: #f0f0f0;
    }

    #toolcheck-app .cs-status-æœªå¯¾å¿œ {
      background-color: #fff3cd;
    }

    #toolcheck-app .cs-status-å¯¾å¿œä¸­ {
      background-color: #d1ecf1;
    }

    #toolcheck-app .cs-status-å®Œäº† {
      background-color: #d4edda;
    }

    #toolcheck-app .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #toolcheck-app .modal-content {
      background: white;
      padding: 1em;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }

    #toolcheck-app .modal-content label {
      font-weight: bold;
      display: block;
      margin-top: 0.5em;
    }

    #toolcheck-app .modal-content input,
    #toolcheck-app .modal-content textarea,
    #toolcheck-app .modal-content select {
      width: 100%;
      margin-top: 4px;
      padding: 6px;
    }

    #toolcheck-app .modal-buttons {
      margin-top: 1em;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    #toolcheck-app .cs-btn {
      padding: 4px 8px;
      font-size: 12px;
    }

    #toolcheck-app #new-sheet-modal {}

    #toolcheck-app .filter-sort-controls {
      display: flex;
      gap: 1em;
      margin-bottom: 1em;
      align-items: center;
    }

    #toolcheck-app .filter-sort-controls label {
      font-size: 14px;
    }

    #toolcheck-app .filter-sort-controls select {
      padding: 4px 8px;
      font-size: 14px;
    }
  </style>

  <div class="header-bar">
    <div id="sheet-title" class="sheet-title" contenteditable="true">æ–°ã—ã„ãƒã‚§ãƒƒã‚¯è¡¨</div>
    <div class="sheet-controls">
      <select id="sheet-selector"></select>
      <button id="sheet-new">ï¼‹æ–°è¦</button>
      <button id="sheet-delete">ğŸ—‘å‰Šé™¤</button>
      <button id="add-entry">äºˆå®šã®è¿½åŠ </button>
      <button id="export-csv">CSVå‡ºåŠ›</button>
    </div>
  </div>

  <div class="filter-sort-controls">
    <label>
      ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:
      <select id="filter-type">
        <option value="">ã™ã¹ã¦</option>
        <option value="æå‡º">æå‡º</option>
        <option value="å›å">å›å</option>
        <option value="å ±å‘Š">å ±å‘Š</option>
        <option value="ä¼è¨€">ä¼è¨€</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </label>
    <label>
      ã‚½ãƒ¼ãƒˆ:
      <select id="sort-by">
        <option value="">æŒ‡å®šãªã—</option>
        <option value="date">æ—¥ä»˜</option>
        <option value="deadline">ç· åˆ‡</option>
        <option value="status">çŠ¶æ…‹</option>
      </select>
      <select id="sort-order">
        <option value="asc">æ˜‡é †</option>
        <option value="desc">é™é †</option>
      </select>
    </label>
  </div>

  <div class="cs-container">
    <table class="cs-table" id="cs-table">
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>æ‹…å½“è€…</th>
          <th>é …ç›®</th>
          <th>å†…å®¹</th>
          <th>ç· åˆ‡</th>
          <th>çŠ¶æ…‹</th>
          <th>æ“ä½œ</th>

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="modal" id="entry-modal">
    <div class="modal-content">
      <label>æ—¥ä»˜<input type="date" id="entry-date"></label>
      <label>æ‹…å½“è€…<input type="text" id="entry-person"></label>
      <label>
        é …ç›®
        <select id="entry-type">
          <option>æå‡º</option>
          <option>å›å</option>
          <option>å ±å‘Š</option>
          <option>ä¼è¨€</option>
          <option>ãã®ä»–</option>
        </select>
      </label>
      <label>å†…å®¹<textarea id="entry-content"></textarea></label>
      <label>ç· åˆ‡<input type="date" id="entry-deadline"></label>

      <label>
        çŠ¶æ…‹
        <select id="entry-status">
          <option>æœªå¯¾å¿œ</option>
          <option>å¯¾å¿œä¸­</option>
          <option>å®Œäº†</option>
        </select>
      </label>
      <div class="modal-buttons">
        <button id="entry-cancel">é–‰ã˜ã‚‹</button>
        <button id="entry-save">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <div class="modal" id="new-sheet-modal">
    <div class="modal-content">
      <label>æ–°ã—ã„ãƒã‚§ãƒƒã‚¯è¡¨ã®åå‰<input type="text" id="new-sheet-name"></label>
      <div class="modal-buttons">
        <button id="new-sheet-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="new-sheet-create">ä½œæˆ</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-entry-modal">
    <div class="modal-content">
      <p>ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
      <div class="modal-buttons">
        <button id="delete-entry-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="delete-entry-confirm">å‰Šé™¤</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-sheet-modal">
    <div class="modal-content">
      <p>ã“ã®ã‚·ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
      <div class="modal-buttons">
        <button id="delete-sheet-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="delete-sheet-confirm">å‰Šé™¤</button>
      </div>
    </div>
  </div>
</div>

<script>
  (() => {
    try {
      const root = document.getElementById("toolcheck-app");
      const modal = root.querySelector("#entry-modal");
      const tableBody = root.querySelector("#cs-table tbody");
      const selector = root.querySelector("#sheet-selector");
      const titleElem = root.querySelector("#sheet-title");

      // æ–°è¦ã‚·ãƒ¼ãƒˆç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ã®å–å¾—
      const newSheetModal = root.querySelector("#new-sheet-modal");
      const newSheetNameInput = root.querySelector("#new-sheet-name");
      const newSheetCancelButton = root.querySelector("#new-sheet-cancel");
      const newSheetCreateButton = root.querySelector("#new-sheet-create");

      // äºˆå®šå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«
      const deleteEntryModal = root.querySelector("#delete-entry-modal");
      const deleteEntryCancelButton = root.querySelector("#delete-entry-cancel");
      const deleteEntryConfirmButton = root.querySelector("#delete-entry-confirm");
      let targetEntryIndex = -1; // å‰Šé™¤å¯¾è±¡ã®äºˆå®šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿æŒ

      // ã‚·ãƒ¼ãƒˆå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«
      const deleteSheetModal = root.querySelector("#delete-sheet-modal");
      const deleteSheetCancelButton = root.querySelector("#delete-sheet-cancel");
      const deleteSheetConfirmButton = root.querySelector("#delete-sheet-confirm");

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚½ãƒ¼ãƒˆ
      const filterTypeSelect = root.querySelector("#filter-type");
      const sortBySelect = root.querySelector("#sort-by");
      const sortOrderSelect = root.querySelector("#sort-order");

      let sheets = {};
      let currentSheet = null;

      function saveSheets() {
        localStorage.setItem("toolcheck-sheets", JSON.stringify(sheets));
      }

      function loadSheets() {
        sheets = JSON.parse(localStorage.getItem("toolcheck-sheets") || "{}");
      }

      function renderSheetOptions() {
        selector.innerHTML = "";
        Object.keys(sheets).forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          selector.appendChild(opt);
        });
        if (currentSheet && !sheets[currentSheet]) {
          currentSheet = null;
        }
        if (!currentSheet && Object.keys(sheets).length > 0) {
          currentSheet = Object.keys(sheets)[0];
        }
        if (currentSheet) {
          selector.value = currentSheet;
        }
      }

      function renderTable() {
        let data = sheets[currentSheet]?.data || [];

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const filterType = filterTypeSelect.value;
        if (filterType) {
          data = data.filter(item => item.type === filterType);
        }

        // ã‚½ãƒ¼ãƒˆ
        const sortBy = sortBySelect.value;
        const sortOrder = sortOrderSelect.value;
        if (sortBy) {
          data.sort((a, b) => {
            let aValue = a[sortBy] || "";
            let bValue = b[sortBy] || "";
            if (sortBy === "date" || sortBy === "deadline") {
              aValue = new Date(aValue);
              bValue = new Date(bValue);
            }
            if (aValue < bValue) return sortOrder === "asc" ? -1 : 1;
            if (aValue > bValue) return sortOrder === "asc" ? 1 : -1;
            return 0;
          });
        }

        tableBody.innerHTML = "";
        data.forEach((item, i) => {
          const tr = document.createElement("tr");
          tr.className = "cs-status-" + item.status;
          [item.date, item.person, item.type, item.content, item.deadline, item.status].forEach(
            (val, id) => {
              const td = document.createElement("td");
              td.textContent = val;
              tr.appendChild(td);

              // ç· åˆ‡æ—¥ãŒ3æ—¥ä»¥å†…ã®å ´åˆã€æ–‡å­—è‰²ã‚’èµ¤ã«ã™ã‚‹
              if (id === 4 && item.deadline) {
                const deadlineDate = new Date(item.deadline);
                const now = new Date();
                const diff = deadlineDate.getTime() - now.getTime();
                const daysUntilDeadline = Math.ceil(diff / (1000 * 60 * 60 * 24));
                if (daysUntilDeadline <= 3 && daysUntilDeadline >= 0) {
                  td.style.color = "red";
                  td.style.fontWeight = "bold";
                }
              }
            }
          );
          const td = document.createElement("td");

          // å‰Šé™¤ãƒœã‚¿ãƒ³
          const deleteButton = document.createElement("button");
          deleteButton.className = "cs-btn";
          deleteButton.textContent = "å‰Šé™¤";
          deleteButton.addEventListener("click", () => {
            openDeleteEntryModal(i); // å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
          });
          td.appendChild(deleteButton);

          // ç·¨é›†ãƒœã‚¿ãƒ³
          const editButton = document.createElement("button");
          editButton.className = "cs-btn";
          editButton.textContent = "ç·¨é›†";
          editButton.addEventListener("click", () => {
            openModal(i); // ç·¨é›†ã™ã‚‹è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã™
          });
          td.appendChild(editButton);

          tr.appendChild(td);
          tableBody.appendChild(tr);
        });
      }

      function openModal(editIndex = -1) {
        modal.style.display = "flex";

        if (editIndex >= 0) {
          // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
          const item = sheets[currentSheet].data[editIndex];
          root.querySelector("#entry-date").value = item.date;
          root.querySelector("#entry-person").value = item.person;
          root.querySelector("#entry-type").value = item.type;
          root.querySelector("#entry-content").value = item.content;
          root.querySelector("#entry-deadline").value = item.deadline;
          root.querySelector("#entry-status").value = item.status;
          root.querySelector("#entry-save").onclick = () => saveEntry(editIndex); // ä¿å­˜å‡¦ç†ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã™
        } else {
          // æ–°è¦è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
          ["entry-date", "entry-person", "entry-content", "entry-deadline"].forEach(id => {
            root.querySelector("#" + id).value = "";
          });
          root.querySelector("#entry-save").onclick = () => saveEntry(); // ä¿å­˜å‡¦ç†ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã•ãªã„
        }
      }

      function closeModal() {
        modal.style.display = "none";
        ["entry-date", "entry-person", "entry-content", "entry-deadline"].forEach(id => {
          root.querySelector("#" + id).value = "";
        });
      }

      function saveEntry(editIndex = -1) {
        const item = {
          date: root.querySelector("#entry-date").value,
          person: root.querySelector("#entry-person").value,
          type: root.querySelector("#entry-type").value,
          content: root.querySelector("#entry-content").value,
          deadline: root.querySelector("#entry-deadline").value,
          status: root.querySelector("#entry-status").value
        };
        if (!sheets[currentSheet]) return;
        if (editIndex >= 0) {
          // ç·¨é›†
          sheets[currentSheet].data[editIndex] = item;
        } else {
          // æ–°è¦è¿½åŠ 
          sheets[currentSheet].data.push(item);
        }
        saveSheets();
        closeModal();
        renderTable();
      }

      root.querySelector("#add-entry").onclick = () => openModal();
      root.querySelector("#entry-cancel").onclick = closeModal;
      root.querySelector("#entry-save").onclick = e => saveEntry();

      selector.onchange = () => {
        currentSheet = selector.value;
        renderTable();
      };

      // æ–°è¦ã‚·ãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
      function openNewSheetModal() {
        newSheetModal.style.display = "flex";
      }

      // æ–°è¦ã‚·ãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      function closeNewSheetModal() {
        newSheetModal.style.display = "none";
        newSheetNameInput.value = ""; // å…¥åŠ›å†…å®¹ã‚’ã‚¯ãƒªã‚¢
      }

      root.querySelector("#sheet-new").onclick = open
      <div id="toolcheck-app">
  <style>
    #toolcheck-app * {
      box-sizing: border-box;
    }

    #toolcheck-app {
      font-family: sans-serif;
      padding: 1em;
      max-width: 1200px;
      margin: auto;
    }

    #toolcheck-app .header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1em;
    }

    #toolcheck-app .sheet-title {
      font-size: 1.5em;
      font-weight: bold;
      flex: 1;
    }

    #toolcheck-app .sheet-title[contenteditable] {
      background: #eef;
      padding: 4px;
      border-radius: 4px;
    }

    #toolcheck-app .sheet-controls {
      display: flex;
      gap: 8px;
    }

    #toolcheck-app select,
    #toolcheck-app button {
      padding: 4px 8px;
      font-size: 14px;
    }

    #toolcheck-app .cs-container {
      display: flex;
      flex-direction: column;
      gap: 1em;
    }

    #toolcheck-app .cs-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    #toolcheck-app .cs-table th,
    #toolcheck-app .cs-table td {
      border: 1px solid #ccc;
      padding: 4px;
      font-size: 12px;
      text-align: center;
      word-wrap: break-word;
    }

    #toolcheck-app .cs-table th {
      background-color: #f0f0f0;
    }

    #toolcheck-app .cs-status-æœªå¯¾å¿œ {
      background-color: #fff3cd;
    }

    #toolcheck-app .cs-status-å¯¾å¿œä¸­ {
      background-color: #d1ecf1;
    }

    #toolcheck-app .cs-status-å®Œäº† {
      background-color: #d4edda;
    }

    #toolcheck-app .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    #toolcheck-app .modal-content {
      background: white;
      padding: 1em;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
    }

    #toolcheck-app .modal-content label {
      font-weight: bold;
      display: block;
      margin-top: 0.5em;
    }

    #toolcheck-app .modal-content input,
    #toolcheck-app .modal-content textarea,
    #toolcheck-app .modal-content select {
      width: 100%;
      margin-top: 4px;
      padding: 6px;
    }

    #toolcheck-app .modal-buttons {
      margin-top: 1em;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    #toolcheck-app .cs-btn {
      padding: 4px 8px;
      font-size: 12px;
    }

    #toolcheck-app #new-sheet-modal {}

    #toolcheck-app .filter-sort-controls {
      display: flex;
      gap: 1em;
      margin-bottom: 1em;
      align-items: center;
    }

    #toolcheck-app .filter-sort-controls label {
      font-size: 14px;
    }

    #toolcheck-app .filter-sort-controls select {
      padding: 4px 8px;
      font-size: 14px;
    }
  </style>

  <div class="header-bar">
    <div id="sheet-title" class="sheet-title" contenteditable="true">æ–°ã—ã„ãƒã‚§ãƒƒã‚¯è¡¨</div>
    <div class="sheet-controls">
      <select id="sheet-selector"></select>
      <button id="sheet-new">ï¼‹æ–°è¦</button>
      <button id="sheet-delete">ğŸ—‘å‰Šé™¤</button>
      <button id="add-entry">äºˆå®šã®è¿½åŠ </button>
      <button id="export-csv">CSVå‡ºåŠ›</button>
    </div>
  </div>

  <div class="filter-sort-controls">
    <label>
      ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:
      <select id="filter-type">
        <option value="">ã™ã¹ã¦</option>
        <option value="æå‡º">æå‡º</option>
        <option value="å›å">å›å</option>
        <option value="å ±å‘Š">å ±å‘Š</option>
        <option value="ä¼è¨€">ä¼è¨€</option>
        <option value="ãã®ä»–">ãã®ä»–</option>
      </select>
    </label>
    <label>
      ã‚½ãƒ¼ãƒˆ:
      <select id="sort-by">
        <option value="">æŒ‡å®šãªã—</option>
        <option value="date">æ—¥ä»˜</option>
        <option value="deadline">ç· åˆ‡</option>
        <option value="status">çŠ¶æ…‹</option>
      </select>
      <select id="sort-order">
        <option value="asc">æ˜‡é †</option>
        <option value="desc">é™é †</option>
      </select>
    </label>
  </div>

  <div class="cs-container">
    <table class="cs-table" id="cs-table">
      <thead>
        <tr>
          <th>æ—¥ä»˜</th>
          <th>æ‹…å½“è€…</th>
          <th>é …ç›®</th>
          <th>å†…å®¹</th>
          <th>ç· åˆ‡</th>
          <th>çŠ¶æ…‹</th>
          <th>æ“ä½œ</th>

        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="modal" id="entry-modal">
    <div class="modal-content">
      <label>æ—¥ä»˜<input type="date" id="entry-date"></label>
      <label>æ‹…å½“è€…<input type="text" id="entry-person"></label>
      <label>
        é …ç›®
        <select id="entry-type">
          <option>æå‡º</option>
          <option>å›å</option>
          <option>å ±å‘Š</option>
          <option>ä¼è¨€</option>
          <option>ãã®ä»–</option>
        </select>
      </label>
      <label>å†…å®¹<textarea id="entry-content"></textarea></label>
      <label>ç· åˆ‡<input type="date" id="entry-deadline"></label>

      <label>
        çŠ¶æ…‹
        <select id="entry-status">
          <option>æœªå¯¾å¿œ</option>
          <option>å¯¾å¿œä¸­</option>
          <option>å®Œäº†</option>
        </select>
      </label>
      <div class="modal-buttons">
        <button id="entry-cancel">é–‰ã˜ã‚‹</button>
        <button id="entry-save">è¿½åŠ </button>
      </div>
    </div>
  </div>

  <div class="modal" id="new-sheet-modal">
    <div class="modal-content">
      <label>æ–°ã—ã„ãƒã‚§ãƒƒã‚¯è¡¨ã®åå‰<input type="text" id="new-sheet-name"></label>
      <div class="modal-buttons">
        <button id="new-sheet-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="new-sheet-create">ä½œæˆ</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-entry-modal">
    <div class="modal-content">
      <p>ã“ã®äºˆå®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
      <div class="modal-buttons">
        <button id="delete-entry-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="delete-entry-confirm">å‰Šé™¤</button>
      </div>
    </div>
  </div>

  <div class="modal" id="delete-sheet-modal">
    <div class="modal-content">
      <p>ã“ã®ã‚·ãƒ¼ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
      <div class="modal-buttons">
        <button id="delete-sheet-cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="delete-sheet-confirm">å‰Šé™¤</button>
      </div>
    </div>
  </div>
</div>

<script>
  (() => {
    try {
      const root = document.getElementById("toolcheck-app");
      const modal = root.querySelector("#entry-modal");
      const tableBody = root.querySelector("#cs-table tbody");
      const selector = root.querySelector("#sheet-selector");
      const titleElem = root.querySelector("#sheet-title");

      // æ–°è¦ã‚·ãƒ¼ãƒˆç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«è¦ç´ ã®å–å¾—
      const newSheetModal = root.querySelector("#new-sheet-modal");
      const newSheetNameInput = root.querySelector("#new-sheet-name");
      const newSheetCancelButton = root.querySelector("#new-sheet-cancel");
      const newSheetCreateButton = root.querySelector("#new-sheet-create");

      // äºˆå®šå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«
      const deleteEntryModal = root.querySelector("#delete-entry-modal");
      const deleteEntryCancelButton = root.querySelector("#delete-entry-cancel");
      const deleteEntryConfirmButton = root.querySelector("#delete-entry-confirm");
      let targetEntryIndex = -1; // å‰Šé™¤å¯¾è±¡ã®äºˆå®šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä¿æŒ

      // ã‚·ãƒ¼ãƒˆå‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ«
      const deleteSheetModal = root.querySelector("#delete-sheet-modal");
      const deleteSheetCancelButton = root.querySelector("#delete-sheet-cancel");
      const deleteSheetConfirmButton = root.querySelector("#delete-sheet-confirm");

      // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚½ãƒ¼ãƒˆ
      const filterTypeSelect = root.querySelector("#filter-type");
      const sortBySelect = root.querySelector("#sort-by");
      const sortOrderSelect = root.querySelector("#sort-order");

      let sheets = {};
      let currentSheet = null;

      function saveSheets() {
        localStorage.setItem("toolcheck-sheets", JSON.stringify(sheets));
      }

      function loadSheets() {
        sheets = JSON.parse(localStorage.getItem("toolcheck-sheets") || "{}");
      }

      function renderSheetOptions() {
        selector.innerHTML = "";
        Object.keys(sheets).forEach(name => {
          const opt = document.createElement("option");
          opt.value = name;
          opt.textContent = name;
          selector.appendChild(opt);
        });
        if (currentSheet && !sheets[currentSheet]) {
          currentSheet = null;
        }
        if (!currentSheet && Object.keys(sheets).length > 0) {
          currentSheet = Object.keys(sheets)[0];
        }
        if (currentSheet) {
          selector.value = currentSheet;
        }
      }

      function renderTable() {
        let data = sheets[currentSheet]?.data || [];

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
        const filterType = filterTypeSelect.value;
        if (filterType) {
          data = data.filter(item => item.type === filterType);
        }

        // ã‚½ãƒ¼ãƒˆ
        const sortBy = sortBySelect.value;
        const sortOrder = sortOrderSelect.value;
        if (sortBy) {
          data.sort((a, b) => {
            let aValue = a[sortBy] || "";
            let bValue = b[sortBy] || "";
            if (sortBy === "date" || sortBy === "deadline") {
              aValue = new Date(aValue);
              bValue = new Date(bValue);
            }
            if (aValue < bValue) return sortOrder === "asc" ? -1 : 1;
            if (aValue > bValue) return sortOrder === "asc" ? 1 : -1;
            return 0;
          });
        }

        tableBody.innerHTML = "";
        data.forEach((item, i) => {
          const tr = document.createElement("tr");
          tr.className = "cs-status-" + item.status;
          [item.date, item.person, item.type, item.content, item.deadline, item.status].forEach(
            (val, id) => {
              const td = document.createElement("td");
              td.textContent = val;
              tr.appendChild(td);

              // ç· åˆ‡æ—¥ãŒ3æ—¥ä»¥å†…ã®å ´åˆã€æ–‡å­—è‰²ã‚’èµ¤ã«ã™ã‚‹
              if (id === 4 && item.deadline) {
                const deadlineDate = new Date(item.deadline);
                const now = new Date();
                const diff = deadlineDate.getTime() - now.getTime();
                const daysUntilDeadline = Math.ceil(diff / (1000 * 60 * 60 * 24));
                if (daysUntilDeadline <= 3 && daysUntilDeadline >= 0) {
                  td.style.color = "red";
                  td.style.fontWeight = "bold";
                }
              }
            }
          );
          const td = document.createElement("td");

          // å‰Šé™¤ãƒœã‚¿ãƒ³
          const deleteButton = document.createElement("button");
          deleteButton.className = "cs-btn";
          deleteButton.textContent = "å‰Šé™¤";
          deleteButton.addEventListener("click", () => {
            openDeleteEntryModal(i); // å‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
          });
          td.appendChild(deleteButton);

          // ç·¨é›†ãƒœã‚¿ãƒ³
          const editButton = document.createElement("button");
          editButton.className = "cs-btn";
          editButton.textContent = "ç·¨é›†";
          editButton.addEventListener("click", () => {
            openModal(i); // ç·¨é›†ã™ã‚‹è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã™
          });
          td.appendChild(editButton);

          tr.appendChild(td);
          tableBody.appendChild(tr);
        });
      }

      function openModal(editIndex = -1) {
        modal.style.display = "flex";

        if (editIndex >= 0) {
          // ç·¨é›†ãƒ¢ãƒ¼ãƒ‰
          const item = sheets[currentSheet].data[editIndex];
          root.querySelector("#entry-date").value = item.date;
          root.querySelector("#entry-person").value = item.person;
          root.querySelector("#entry-type").value = item.type;
          root.querySelector("#entry-content").value = item.content;
          root.querySelector("#entry-deadline").value = item.deadline;
          root.querySelector("#entry-status").value = item.status;
          root.querySelector("#entry-save").onclick = () => saveEntry(editIndex); // ä¿å­˜å‡¦ç†ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã™
        } else {
          // æ–°è¦è¿½åŠ ãƒ¢ãƒ¼ãƒ‰
          ["entry-date", "entry-person", "entry-content", "entry-deadline"].forEach(id => {
            root.querySelector("#" + id).value = "";
          });
          root.querySelector("#entry-save").onclick = () => saveEntry(); // ä¿å­˜å‡¦ç†ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ¸¡ã•ãªã„
        }
      }

      function closeModal() {
        modal.style.display = "none";
        ["entry-date", "entry-person", "entry-content", "entry-deadline"].forEach(id => {
          root.querySelector("#" + id).value = "";
        });
      }

      function saveEntry(editIndex = -1) {
        const item = {
          date: root.querySelector("#entry-date").value,
          person: root.querySelector("#entry-person").value,
          type: root.querySelector("#entry-type").value,
          content: root.querySelector("#entry-content").value,
          deadline: root.querySelector("#entry-deadline").value,
          status: root.querySelector("#entry-status").value
        };
        if (!sheets[currentSheet]) return;
        if (editIndex >= 0) {
          // ç·¨é›†
          sheets[currentSheet].data[editIndex] = item;
        } else {
          // æ–°è¦è¿½åŠ 
          sheets[currentSheet].data.push(item);
        }
        saveSheets();
        closeModal();
        renderTable();
      }

      root.querySelector("#add-entry").onclick = () => openModal();
      root.querySelector("#entry-cancel").onclick = closeModal;
      root.querySelector("#entry-save").onclick = e => saveEntry();

      selector.onchange = () => {
        currentSheet = selector.value;
        renderTable();
      };

      // æ–°è¦ã‚·ãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ã
      function openNewSheetModal() {
        newSheetModal.style.display = "flex";
      }

      // æ–°è¦ã‚·ãƒ¼ãƒˆä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      function closeNewSheetModal() {
        newSheetModal.style.display = "none";
        newSheetNameInput.value =
