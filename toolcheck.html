<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ToolCheck</title>
  <style>
    #toolcheck-app * { box-sizing: border-box; }
    #toolcheck-app {
      font-family: sans-serif;
      padding: 1em;
      max-width: 1200px;
      margin: auto;
    }
    /* 以下スタイルは元と同じ */
  </style>
</head>
<body>
  <div id="toolcheck-app">
    <div class="header-bar">
      <div id="sheet-title" class="sheet-title" contenteditable="true">新しいチェック表</div>
      <div class="sheet-controls">
        <select id="sheet-selector"></select>
        <button id="sheet-new">＋新規</button>
        <button id="sheet-delete">🗑削除</button>
        <button id="add-entry">予定の追加</button>
        <button id="export-csv">CSV出力</button>
      </div>
    </div>

    <div class="cs-container">
      <div class="filter-bar" style="margin-bottom: 1em;">
        担当者：
        <select id="filter-person"><option value="">すべて</option></select>
        項目：
        <select id="filter-type"><option value="">すべて</option></select>
        状態：
        <select id="filter-status">
          <option value="">すべて</option>
          <option value="未対応">未対応</option>
          <option value="対応中">対応中</option>
          <option value="完了">完了</option>
        </select>
      </div>
      <table class="cs-table" id="cs-table">
        <thead>
          <tr>
            <th onclick="sortBy('date')">日付 ⇅</th>
            <th onclick="sortBy('person')">担当者 ⇅</th>
            <th onclick="sortBy('type')">項目 ⇅</th>
            <th onclick="sortBy('content')">内容 ⇅</th>
            <th onclick="sortBy('deadline')">締切 ⇅</th>
            <th onclick="sortBy('status')">状態 ⇅</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="modal" id="entry-modal">
      <div class="modal-content">
        <label>日付<input type="date" id="entry-date"></label>
        <label>担当者<input type="text" id="entry-person"></label>
        <label>項目<input type="text" id="entry-type" list="type-suggestions"></label>
        <datalist id="type-suggestions"></datalist>
        <label>内容<textarea id="entry-content"></textarea></label>
        <label>締切<input type="date" id="entry-deadline"></label>
        <label>状態
          <select id="entry-status">
            <option>未対応</option><option>対応中</option><option>完了</option>
          </select>
        </label>
        <div class="modal-buttons">
          <button id="entry-cancel">閉じる</button>
          <button id="entry-save">保存</button>
        </div>
      </div>
    </div>
  </div>

  <script>
(() => {
  const root = document.getElementById("toolcheck-app");
  const typeInput = root.querySelector("#entry-type");
  const typeDatalist = root.querySelector("#type-suggestions");
  const filterType = document.getElementById("filter-type");

  function getSavedTypes() {
    return JSON.parse(localStorage.getItem("toolcheck-types") || "[]");
  }
  function saveType(type) {
    if (!type) return;
    const types = getSavedTypes();
    if (!types.includes(type)) {
      types.push(type);
      localStorage.setItem("toolcheck-types", JSON.stringify(types));
    }
  }
  function renderTypeSuggestions() {
    const types = getSavedTypes();
    typeDatalist.innerHTML = "";
    types.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      typeDatalist.appendChild(opt);
    });
  }
  function renderFilterTypes() {
    const types = getSavedTypes();
    filterType.innerHTML = '<option value="">すべて</option>';
    types.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      filterType.appendChild(opt);
    });
  }

  document.getElementById("entry-save").addEventListener("click", () => {
    const type = typeInput.value.trim();
    if (type) {
      saveType(type);
      renderTypeSuggestions();
      renderFilterTypes();
    }
  });

  document.getElementById("filter-type").addEventListener("change", (e) => {
    window.filterType = e.target.value;
    renderTable();
  });

  window.addEventListener("load", () => {
    renderTypeSuggestions();
    renderFilterTypes();
  });
})();
  </script>
</body>
</html>
