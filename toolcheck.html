<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ToolCheck</title>
  <style>
    #toolcheck-app * { box-sizing: border-box; }
    #toolcheck-app {
      font-family: sans-serif;
      padding: 1em;
      max-width: 1200px;
      margin: auto;
    }
    /* ä»¥ä¸‹ã‚¹ã‚¿ã‚¤ãƒ«ã¯å…ƒã¨åŒã˜ */
  </style>
</head>
<body>
  <div id="toolcheck-app">
    <div class="header-bar">
      <div id="sheet-title" class="sheet-title" contenteditable="true">æ–°ã—ã„ãƒã‚§ãƒƒã‚¯è¡¨</div>
      <div class="sheet-controls">
        <select id="sheet-selector"></select>
        <button id="sheet-new">ï¼‹æ–°è¦</button>
        <button id="sheet-delete">ğŸ—‘å‰Šé™¤</button>
        <button id="add-entry">äºˆå®šã®è¿½åŠ </button>
        <button id="export-csv">CSVå‡ºåŠ›</button>
      </div>
    </div>

    <div class="cs-container">
      <div class="filter-bar" style="margin-bottom: 1em;">
        æ‹…å½“è€…ï¼š
        <select id="filter-person"><option value="">ã™ã¹ã¦</option></select>
        é …ç›®ï¼š
        <select id="filter-type"><option value="">ã™ã¹ã¦</option></select>
        çŠ¶æ…‹ï¼š
        <select id="filter-status">
          <option value="">ã™ã¹ã¦</option>
          <option value="æœªå¯¾å¿œ">æœªå¯¾å¿œ</option>
          <option value="å¯¾å¿œä¸­">å¯¾å¿œä¸­</option>
          <option value="å®Œäº†">å®Œäº†</option>
        </select>
      </div>
      <table class="cs-table" id="cs-table">
        <thead>
          <tr>
            <th onclick="sortBy('date')">æ—¥ä»˜ â‡…</th>
            <th onclick="sortBy('person')">æ‹…å½“è€… â‡…</th>
            <th onclick="sortBy('type')">é …ç›® â‡…</th>
            <th onclick="sortBy('content')">å†…å®¹ â‡…</th>
            <th onclick="sortBy('deadline')">ç· åˆ‡ â‡…</th>
            <th onclick="sortBy('status')">çŠ¶æ…‹ â‡…</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="modal" id="entry-modal">
      <div class="modal-content">
        <label>æ—¥ä»˜<input type="date" id="entry-date"></label>
        <label>æ‹…å½“è€…<input type="text" id="entry-person"></label>
        <label>é …ç›®<input type="text" id="entry-type" list="type-suggestions"></label>
        <datalist id="type-suggestions"></datalist>
        <label>å†…å®¹<textarea id="entry-content"></textarea></label>
        <label>ç· åˆ‡<input type="date" id="entry-deadline"></label>
        <label>çŠ¶æ…‹
          <select id="entry-status">
            <option>æœªå¯¾å¿œ</option><option>å¯¾å¿œä¸­</option><option>å®Œäº†</option>
          </select>
        </label>
        <div class="modal-buttons">
          <button id="entry-cancel">é–‰ã˜ã‚‹</button>
          <button id="entry-save">ä¿å­˜</button>
        </div>
      </div>
    </div>
  </div>

  <script>
(() => {
  const root = document.getElementById("toolcheck-app");
  const typeInput = root.querySelector("#entry-type");
  const typeDatalist = root.querySelector("#type-suggestions");
  const filterType = document.getElementById("filter-type");

  function getSavedTypes() {
    return JSON.parse(localStorage.getItem("toolcheck-types") || "[]");
  }
  function saveType(type) {
    if (!type) return;
    const types = getSavedTypes();
    if (!types.includes(type)) {
      types.push(type);
      localStorage.setItem("toolcheck-types", JSON.stringify(types));
    }
  }
  function renderTypeSuggestions() {
    const types = getSavedTypes();
    typeDatalist.innerHTML = "";
    types.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      typeDatalist.appendChild(opt);
    });
  }
  function renderFilterTypes() {
    const types = getSavedTypes();
    filterType.innerHTML = '<option value="">ã™ã¹ã¦</option>';
    types.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      filterType.appendChild(opt);
    });
  }

  document.getElementById("entry-save").addEventListener("click", () => {
    const type = typeInput.value.trim();
    if (type) {
      saveType(type);
      renderTypeSuggestions();
      renderFilterTypes();
    }
  });

  document.getElementById("filter-type").addEventListener("change", (e) => {
    window.filterType = e.target.value;
    renderTable();
  });

  window.addEventListener("load", () => {
    renderTypeSuggestions();
    renderFilterTypes();
  });
})();
  </script>
</body>
</html>
