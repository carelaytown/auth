
<!-- CARELAYタウン: 行政・自治体リンク集アプリ -->
<div id="librarygovlink-app">
  <!-- アプリのUIがここに挿入されます -->
</div>

<style>
#librarygovlink-app {
  font-family: sans-serif;
  padding: 1em;
}
#librarygovlink-app .card {
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-bottom: 1em;
  padding: 1em;
}
</style>

<script>
(() => {
  const supabaseUrl = "https://viihcgkjzzhkdiwdzdex.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpaWhjZ2tqenpoa2Rpd2R6ZGV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYwNzE4MDksImV4cCI6MjA2MTY0NzgwOX0.3SMdVvDEp103fwnLvgtsec7J7ly4A_SEJlrEb0BZ9YM";
  const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

  const app = document.getElementById("librarygovlink-app");

  const loadLinks = async () => {
    const { data, error } = await supabase
      .from("librarygovlink")
      .select("*")
      .order("pref_code", { ascending: true });

    if (error) {
      console.error("読み込みエラー:", error);
      app.innerHTML = "<p>データの読み込みに失敗しました。</p>";
      return;
    }

    render(data);
  };

  const render = (rows) => {
    app.innerHTML = "";
    rows.forEach(row => {
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${row.pref_name_ja} ${row.municipality_name_ja}</h3>
        ${[1,2,3].map(i => row["link_title" + i] ? `<p><a href="${row["link_url" + i]}" target="_blank">${row["link_title" + i]}</a></p>` : "").join("")}
      `;
      app.appendChild(card);
    });
  };

  loadLinks();
})();
</script>
